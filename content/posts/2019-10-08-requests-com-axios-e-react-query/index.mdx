---
title: ğŸ‘¨â€ğŸ’» Requests com Axios e React Query
author: Diego Souza
date: 2019-10-08
hero: ./images/hero.jpg
excerpt: Ao fazer uma request sempre pensamos o que usar e como tratar as requisiÃ§Ãµes. Veja como essas duas bibliotecas podem te ajudar.
---

Meu primeiro artigo no blog Ã© para falar sobre requisiÃ§Ãµes. Qual biblioteca usar para fazer requisiÃ§Ãµes? Como tratar isso no momento da renderizaÃ§Ã£o?

## AXIOS ğŸ˜

Essa biblioteca Ã© utilizada para trabalhar com API REST. Fazer requisiÃ§Ãµes numa API, com **GET**, **POST**, **DELETE**, **PUT** e **PATCH**.  
VocÃª pode fazer a instalaÃ§Ã£o dela no seu projeto dessa forma:

```shell
yarn add axios
# or
npm install axios 
# or
bower install axios
```

### CONFIGURANDO UMA URL BASE

Para usar o **axios** e usar uma URL como base podemos criar um arquivo chamado `api.js` dentro de uma pasta chamada `services` na pasta `src` do projeto.

```javascript
import axios from 'axios';

const api = axios.create({
    baseURL: 'https://api.github.com/',
    timeout: 1000,
    headers: {
      /** 
       * Coloque aqui os headers que precisar.
       * Assim eles sempre serÃ£o incluÃ­dos na requisiÃ§Ã£o.
       */
    }
})
```

Dessa forma, todas as chamadas que vocÃª fizer, essa URL serÃ¡ incluÃ­da. Assim nÃ£o Ã© necessÃ¡rio incluÃ­-la na requisiÃ§Ã£o. Por exemplo:

```javascript
import api from '../services/api';

const [data, setData] = useState([]);

useEffect(() => {
  const getUsersGitHub = async () => {
    const result = await api.get('users');
    
    setData(result.data);
  };

  getUsersGitHub();
}, []);

```

## REACT QUERY ğŸ˜

Mas agora que temos a resposta do servidor, queremos tratar isso no momento da renderizaÃ§Ã£o, talvez colocando um *loading* ou um *spinner* para mostrar 
ao usuÃ¡rio que alguma coisa estÃ¡ acontecendo, que algo estÃ¡ carregando.

Essa biblioteca usa o **hooks** do **React** e pode nos ajudar a fazer esse tratamento de forma bem simples na funÃ§Ã£o de renderizaÃ§Ã£o.

```shell
yarn add react-query
# or
npm i --save react-query
```

Vamos aproveitar o cÃ³digo acima para adicionar esse recurso.

```javascript
import api from '../services/api';
import { useQuery } from 'react-query';

useEffect(() => {
  const getUsersGitHub = async () => {
    const { data: result, loading, error } = useQuery('users', 
      () => await api.get('users');
    );
  };

  getUsersGitHub();
}, []);

```

Basicamente, o `useQuery` cria as variÃ¡veis de `state` que vamos usar para receber os dados da requisiÃ§Ã£o, controlar o *loading* e receber algum erro caso tenha, respectivamente
o `data`, o `isLoading`, e o `error`.

EntÃ£o, podemos usar essas trÃªs variÃ¡veis na renderizaÃ§Ã£o.

```javascript
{
  isLoading ? <Loading />                   : 
  error     ? <Error />                     : 
  result    ? <Users data={result.data} />  : 
  null
}
```

A boa organizaÃ§Ã£o do layout e componentes nos permite escrever menos cÃ³digo ao lidar com essas situaÃ§Ãµes. No cÃ³digo acima apenas verificamos se existe o `isLoading`,
o `error` e o `result`. Renomeei o `data` na desestruturaÃ§Ã£o porquÃª o `useQuery` retorna um `data` e o axios tambÃ©m, entÃ£o para nÃ£o confundir fiz dessa forma.  
Formatei o cÃ³digo acima separado em linhas para ficar mais fÃ¡cil a visualizaÃ§Ã£o aqui no artigo, mas vocÃª pode formatar como vocÃª desejar.

Como o `result.data` estÃ¡ sendo passado para uma propriedade do componente `Users`, entÃ£o vocÃª pode usar agora a propriedade `data` nesse componente para 
fazer o `map` e mostrar o resultado na tela.

## LINKS ÃšTEIS ğŸ‘©â€ğŸ’»

* [DocumentaÃ§Ã£o do Axios](https://github.com/axios/axios)
* [DocumentaÃ§Ã£o do React Query](https://github.com/tannerlinsley/react-query)